<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Fun Tetris</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            min-height: 100vh;
        }

        .game-container {
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        #game-board {
            border: 2px solid #30475e;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            min-width: 200px;
        }

        .score-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .controls {
            margin-top: 20px;
            text-align: center;
        }

        button {
            background: #4ecca3;
            border: none;
            padding: 10px 20px;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.1s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .next-piece-container {
            margin-top: 20px;
            text-align: center;
        }

        #next-piece {
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Super Fun Tetris!</h1>
    <div class="game-container">
        <canvas id="game-board" width="300" height="600"></canvas>
        <div class="info-panel">
            <div class="score-box">
                <h2>Score</h2>
                <p id="score">0</p>
            </div>
            <div class="score-box">
                <h2>Level</h2>
                <p id="level">1</p>
            </div>
            <div class="next-piece-container">
                <h2>Next Piece</h2>
                <canvas id="next-piece" width="100" height="100"></canvas>
            </div>
            <div class="controls">
                <button id="start-btn">Start Game</button>
                <p>Controls:</p>
                <p>← → : Move</p>
                <p>↑ : Rotate</p>
                <p>↓ : Soft Drop</p>
                <p>Space : Hard Drop</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game-board');
        const ctx = canvas.getContext('2d');
        const nextPieceCanvas = document.getElementById('next-piece');
        const nextPieceCtx = nextPieceCanvas.getContext('2d');
        const blockSize = 30;
        const rows = 20;
        const cols = 10;
        let score = 0;
        let level = 1;
        let gameInterval;
        let currentPiece;
        let nextPiece;
        let board = Array(rows).fill().map(() => Array(cols).fill(0));
        let gameOver = false;

        const colors = [
            null,
            '#FF0D72', // I
            '#0DC2FF', // J
            '#0DFF72', // L
            '#F538FF', // O
            '#FF8E0D', // S
            '#FFE138', // T
            '#3877FF'  // Z
        ];

        const pieces = [
            [[1, 1, 1, 1]],                         // I
            [[2, 0, 0], [2, 2, 2]],                // J
            [[0, 0, 3], [3, 3, 3]],                // L
            [[4, 4], [4, 4]],                      // O
            [[0, 5, 5], [5, 5, 0]],                // S
            [[0, 6, 0], [6, 6, 6]],                // T
            [[7, 7, 0], [0, 7, 7]]                 // Z
        ];

        class Piece {
            constructor(shape, ctx) {
                this.shape = shape;
                this.ctx = ctx;
                this.y = 0;
                this.x = Math.floor(cols / 2) - Math.floor(shape[0].length / 2);
            }

            draw() {
                this.shape.forEach((row, y) => {
                    row.forEach((value, x) => {
                        if (value > 0) {
                            this.ctx.fillStyle = colors[value];
                            this.ctx.fillRect(
                                (this.x + x) * blockSize,
                                (this.y + y) * blockSize,
                                blockSize - 1,
                                blockSize - 1
                            );
                        }
                    });
                });
            }
        }

        function createPiece() {
            const pieceIndex = Math.floor(Math.random() * pieces.length);
            return new Piece(pieces[pieceIndex], ctx);
        }

        function drawBoard() {
            board.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value > 0) {
                        ctx.fillStyle = colors[value];
                        ctx.fillRect(
                            x * blockSize,
                            y * blockSize,
                            blockSize - 1,
                            blockSize - 1
                        );
                    }
                });
            });
        }

        function collision(piece, x = 0, y = 0) {
            return piece.shape.some((row, dy) => {
                return row.some((value, dx) => {
                    if (value !== 0) {
                        const newX = piece.x + dx + x;
                        const newY = piece.y + dy + y;
                        return (
                            newX < 0 ||
                            newX >= cols ||
                            newY >= rows ||
                            (newY >= 0 && board[newY][newX] !== 0)
                        );
                    }
                    return false;
                });
            });
        }

        function merge(piece) {
            piece.shape.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        board[piece.y + y][piece.x + x] = value;
                    }
                });
            });
        }

        function rotate(piece) {
            const newShape = piece.shape[0].map((_, i) =>
                piece.shape.map(row => row[i]).reverse()
            );
            const oldShape = piece.shape;
            piece.shape = newShape;
            if (collision(piece)) {
                piece.shape = oldShape;
            }
        }

        function clearLines() {
            let linesCleared = 0;
            outer: for (let y = rows - 1; y >= 0; y--) {
                for (let x = 0; x < cols; x++) {
                    if (board[y][x] === 0) continue outer;
                }
                const row = board.splice(y, 1)[0].fill(0);
                board.unshift(row);
                y++;
                linesCleared++;
            }
            if (linesCleared > 0) {
                score += linesCleared * 100 * level;
                document.getElementById('score').textContent = score;
                if (score >= level * 1000) {
                    level++;
                    document.getElementById('level').textContent = level;
                    clearInterval(gameInterval);
                    gameInterval = setInterval(update, 1000 / level);
                }
            }
        }

        function drawNextPiece() {
            nextPieceCtx.clearRect(0, 0, nextPieceCanvas.width, nextPieceCanvas.height);
            nextPiece.shape.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value > 0) {
                        nextPieceCtx.fillStyle = colors[value];
                        nextPieceCtx.fillRect(
                            x * 25 + 25,
                            y * 25 + 25,
                            24,
                            24
                        );
                    }
                });
            });
        }

        function update() {
            if (gameOver) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            currentPiece.y++;
            
            if (collision(currentPiece, 0, 0)) {
                currentPiece.y--;
                merge(currentPiece);
                clearLines();
                if (currentPiece.y === 0) {
                    gameOver = true;
                    alert('Game Over! Score: ' + score);
                    return;
                }
                currentPiece = nextPiece;
                nextPiece = createPiece();
                drawNextPiece();
            }
            
            drawBoard();
            currentPiece.draw();
        }

        document.addEventListener('keydown', event => {
            if (gameOver) return;

            switch (event.keyCode) {
                case 37: // Left
                    if (!collision(currentPiece, -1, 0)) currentPiece.x--;
                    break;
                case 39: // Right
                    if (!collision(currentPiece, 1, 0)) currentPiece.x++;
                    break;
                case 40: // Down
                    if (!collision(currentPiece, 0, 1)) currentPiece.y++;
                    break;
                case 38: // Up (rotate)
                    rotate(currentPiece);
                    break;
                case 32: // Space (hard drop)
                    while (!collision(currentPiece, 0, 1)) {
                        currentPiece.y++;
                        score += 2;
                    }
                    document.getElementById('score').textContent = score;
                    break;
            }
        });

        document.getElementById('start-btn').addEventListener('click', () => {
            // Reset game state
            board = Array(rows).fill().map(() => Array(cols).fill(0));
            score = 0;
            level = 1;
            gameOver = false;
            document.getElementById('score').textContent = '0';
            document.getElementById('level').textContent = '1';
            
            // Clear any existing interval
            if (gameInterval) clearInterval(gameInterval);
            
            // Initialize pieces
            currentPiece = createPiece();
            nextPiece = createPiece();
            drawNextPiece();
            
            // Start game loop
            gameInterval = setInterval(update, 1000);
        });
    </script>
</body>
</html>
